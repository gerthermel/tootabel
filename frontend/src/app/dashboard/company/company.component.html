<div class="top d-none d-lg-block">
  <div class="input-group mr-3">
    <label class="input-group-text" for="inputGroupSelect01">
      <fa-icon [icon]="['fas', 'map-marked-alt']" ></fa-icon>
    </label>
    <select class="form-select" id="inputGroupSelect01">
      <option selected>Töömaa</option>
    </select>
    <div class="shadow-bottom"></div>
  </div>

  <div class="input-group">
    <label class="input-group-text" for="">
      <fa-icon [icon]="['fas', 'calendar-alt']" ></fa-icon>
    </label>
    <select class="form-select first" id="" (change)="this.filterMonthChange($event.target.value)">
      <option 
        name="filterMonth"
        *ngFor="let item of this.table.months | keyvalue:returnZero"  value="{{convertMonth(item.key)}}" [attr.selected]="item.key == this.table.filterSelectedMonth?true:null">{{item.value}}
      </option>
    </select>
    <select class="form-select" id="" (change)="this.filterYearChange($event.target.value)">
      <option 
        name="filterMonth"
        *ngFor="let item of this.table.years | keyvalue:returnZero"  value="{{item.value}}" [attr.selected]="item.value == this.table.filterSelectedYear?true:null">{{item.value}}
      </option>
    </select>
  </div>

  <div class="btn btn-success addHours" (click)='this.company.openSidebar("newEntry")'>
    <fa-icon [icon]="['fas', 'user-clock']" class="mr-2"></fa-icon>
    Lisa Sissekanne
  </div>
</div>
<div class="middle scroll-1">
    <table class="table table-bordered">
      <tr>
        <th scope="col text-center" style="width:50px">Päev</th>
        <th scope="col text-center" style="width:100px">Töömaa</th>
        <th scope="col text-center" style="width:50px">Tunnid</th>
        <th scope="col text-center">Ülesanded/Märkused</th>
        <th scope="col text-center" style="width:50px"></th>
      </tr>
      <ng-container *ngFor="let item of this.table.hours | keyvalue : returnZero; index as i">
        <!-- Single Row -->
        <tr *ngIf="objectKeys( item.value ).length < 2 ; else multi" [attr.id]=" item.key == this.table.currentDate ? 'today' : null"> 
          <ng-template [ngIf]="objectKeys( item.value ).length == 1">
            <td class="let days text-center align-middle" >
              {{i+1}} 
            </td>
            <td class="object" >
              <input type="text" [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id" [attr.property]="'object'" (keypress)="this.table.edit($event)" value="{{ item.value[ objectKeys(item.value)[0] ].object }}"/>
            </td>
            <td class="hours text-center">
              <input type="text" [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id" [attr.property]="'hours'" (keypress)="this.table.edit($event)" value="{{ item.value[ objectKeys(item.value)[0] ].hours }}"/>
            </td>
            <td class="notes">
              <textarea rows="1" autosize  [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id" [attr.property]="'notes'" (keypress)="this.table.edit($event)" >{{ item.value[ objectKeys(item.value)[0] ].notes }} </textarea>
            </td>
            <td class="options">
              <fa-icon [icon]="['far', 'trash-alt']" (click)="this.table.deleteEntry( item.value[ objectKeys(item.value)[0] ].id, item.key  )"></fa-icon>
            </td>
          </ng-template>
          <ng-template [ngIf]="objectKeys( item.value ).length == 0">

            <td class="let days text-center align-middle" >
              {{i+1}}
            </td>
            <td class="object" ></td>
            <td class="hours text-center"></td>
            <td class="notes"></td>
            <td class="options">
            </td>
          </ng-template>
        </tr>
        <!-- Multi Row -->
        <ng-template #multi>
          <tr [attr.id]=" item.key == this.table.currentDay ? 'today' : null" [attr.id]=" item.key == this.table.currentDate ? 'today' : null">
            <td class="let days text-center align-middle" [attr.rowspan]="objectKeys(item.value).length">
              {{i+1}}
            </td>
            <td class="object" >
              <input type="text" [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id" [attr.property]="'id'" (keypress)="this.table.edit($event)" value="{{ item.value[ objectKeys(item.value)[0] ].object }}"/>
            </td>
            <td class="hours text-center">
              <input type="text" [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id"  [attr.property]="'hours'"  (keypress)="this.table.edit($event)" value="{{ item.value[ objectKeys(item.value)[0] ].hours }}" />
            </td>
            <td class="notes" >
              <textarea rows="1" autosize  [attr.itemId]="item.value[ objectKeys(item.value)[0] ].id" [attr.property]="'notes'" (keypress)="this.table.edit($event)" > {{ item.value[ objectKeys(item.value)[0] ].notes }}</textarea>
            </td>
            <td class="options">
              <fa-icon [icon]="['far', 'trash-alt']"></fa-icon>
            </td>
          </tr>
          <ng-container *ngFor="let row of item.value | keyvalue : returnZero | slice:1 ">
            <tr >
              <td class="object" >
                <input type="text" [attr.itemId]="row.value.id" [attr.property]="'object'" (keypress)="this.table.edit($event)" value="{{row.value.object }}"/>
              </td>
              <td class="hours text-center">
                <input type="text" [attr.itemId]="row.value.id" [attr.property]="'hours'" (keypress)="this.table.edit($event)" value="{{row.value.hours }}"/>
              </td>
              <td class="notes">
                <textarea  rows="1" autosize  [attr.itemId]="row.value.id" [attr.property]="'notes'" (keypress)="this.table.edit($event)" >{{row.value.notes }}</textarea>
              </td>
              <td class="options">
                <fa-icon [icon]="['far', 'trash-alt']" (click)="this.table.deleteEntry( row.value.id, item.key )" ></fa-icon>
              </td>
            </tr>
          </ng-container>
        </ng-template>

        
      </ng-container>
      <!--
      <ng-container *ngFor="let item of this.table.hours[ this.table.filterSelectedYear ][ this.table.filterSelectedMonth ] | keyvalue : returnZero">
        <tr *ngIf="objectKeys( item.value ).length < 2; else multi" [attr.id]=" item.key == this.table.currentDay ? 'today' : null">
          <td class="days text-center align-middle" >
            {{item.key}}
          </td>
          <td class="object" >{{ objectKeys(item.value)[0] }}</td>
          <td class="notes"></td>
          <td class="hours text-center"></td>
          <td class="options">
            <fa-icon [icon]="['far', 'trash-alt']" *ngIf="objectKeys( item.value ).length > 0" (click)="this.table.deleteEntry( item.value[  objectKeys( item.value )[0] ]['id'] )"></fa-icon>
          </td>
        </tr>
        <ng-template #multi>
          <tr [attr.id]=" item.key == this.table.currentDay ? 'today' : null">
            <td class="days text-center align-middle" [attr.rowspan]="objectKeys(item.value).length">{{item.key}}</td>
            <td class="object" >{{ objectKeys(item.value)[0] }}</td>
            <td class="notes">{{  this.table.hours[ this.table.filterSelectedYear ][ this.table.filterSelectedMonth ][item.key][ objectKeys(item.value)[0] ]['task'] }}</td>
            <td class="hours text-center">{{ this.table.hours[ this.table.filterSelectedYear ][ this.table.filterSelectedMonth ][item.key][  objectKeys(item.value)[0] ]['hours'] }}</td>
            <td class="options">
              <fa-icon [icon]="['far', 'trash-alt']" (click)="this.table.deleteEntry( objectKeys(item.value)[0][id]  )"></fa-icon>
            </td>
          </tr>
          <ng-container *ngFor="let tyymaa of item.value | keyvalue : returnZero | slice:1 ">
            <tr>
              <td class="object" >{{ tyymaa.key }}</td>
              <td class="notes">{{ this.table.hours[ this.table.filterSelectedYear ][ this.table.filterSelectedMonth ][item.key][  tyymaa.key ]['task'] }}</td>
              <td class="hours text-center">{{ this.table.hours[ this.table.filterSelectedYear ][ this.table.filterSelectedMonth ][item.key][  tyymaa.key ]['hours'] }}</td>
              <td class="options">
                <fa-icon [icon]="['far', 'trash-alt']" (click)="this.table.deleteEntry( item.value[tyymaa.key].id )"></fa-icon>
              </td>
            </tr>
          </ng-container>
        </ng-template>
      </ng-container>
      -->
    </table>
</div>
<div id="loadingTables" *ngIf="this.table.isTableLoading">
  <fa-icon icon="circle-notch" spin="true"></fa-icon>
</div>

<div class="bottom">
  <div class="wrap">
    <div class="left d-lg-none align-self-center">
      <button class="btn btn-primary" (click)='this.company.openSidebar("newFilter")'>
        <fa-icon [icon]="['fas','chevron-up']"></fa-icon>
      </button>
    </div>
    <div class="middle text-center align-self-center">
      <div class="d-none d-lg-block">
        {{ this.table.totalHours }}<br>
        <small>Tunde Kokku</small>
      </div>
      <div class="d-lg-none">
        <div class="btn-group w-100">
          <button type="button" class="btn"><fa-icon [icon]="['fas', 'chevron-left']" (click)="this.table.prevMonth()"></fa-icon></button>
          <div class="btn-group month w-100" ngbDropdown role="group" container="body">
            <button class="btn" ngbDropdownToggle>{{ this.table.months[this.table.filterSelectedMonth] }}</button>
            <div class="dropdown-menu" ngbDropdownMenu>
                <button ngbDropdownItem (click)="this.filterMonthChange($event.target.value)"
                  name="filterMonth"
                  *ngFor="let item of this.table.months | keyvalue:returnZero"  value="{{convertMonth(item.key)}}" [attr.id]="item.key == this.table.filterSelectedMonth?'currentMonth':null">{{item.value}}
              </button>
            </div>
          </div>
          <button type="button" class="btn"><fa-icon [icon]="['fas', 'chevron-right']" (click)="this.table.nextMonth()"></fa-icon></button>
        </div>
      </div>
    </div>
    <div class="right text-right d-lg-none align-self-center">
      <button class="btn btn-success" (click)='this.company.openSidebar("newEntry")'>
        <fa-icon [icon]="['far','calendar-check']" ></fa-icon>
      </button>
    </div>
  </div>
  <div class="row d-none pr-3 pl-3 pt-1 pb-1 text-center align-self-center">
  </div>
</div>
